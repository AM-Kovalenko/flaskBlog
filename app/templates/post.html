{% extends "base.html" %}
{% block title %}{{ post.title }}{% endblock %}
{% block content %}
<a href="{{ url_for('main.index') }}" class="btn btn-link">&larr; Назад</a>
<h1>{{ post.title }}</h1>
<p class="text-muted">{{ post.author or 'Аноним' }} — {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
<div class="mb-4">{{ post.body }}</div>

<div class="mb-4">
  <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('main.edit_post', post_id=post.id) }}">Редактировать</a>
  <form action="{{ url_for('main.delete_post', post_id=post.id) }}" method="post" style="display:inline;">
    <button class="btn btn-danger btn-sm" type="submit" onclick="return confirm('Удалить пост?')">Удалить</button>
  </form>
</div>

<h3>Комментарии ({{ post.comments.count() }})</h3>
{% for c in post.comments.order_by('created_at') %}
  <div class="border rounded p-2 mb-2">
    <p class="mb-1">{{ c.body }}</p>
    <small class="text-muted">{{ c.author or 'Аноним' }} — {{ c.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
  </div>
{% else %}
  <p>Комментариев пока нет.</p>
{% endfor %}

<hr>
<h4>Добавить комментарий</h4>
<form method="post" action="{{ url_for('main.add_comment', post_id=post.id) }}">
  {{ form.hidden_tag() }}
  <div class="mb-3">
    {{ form.author.label(class="form-label") }}
    {{ form.author(class="form-control") }}
  </div>
  <div class="mb-3">
    {{ form.body.label(class="form-label") }}
    {{ form.body(class="form-control", rows=4) }}
  </div>
  {{ form.submit(class="btn btn-primary") }}
</form>
{% endblock %}
